<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pong ‚Äî Samuel Barnhurst</title>
  <style>
    :root{
      --bg:#0d1117; --card:#161b22; --ink:#e6edf3; --muted:#30363d; --accent:#00ffff; --accent-2:#00b3b3;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--ink);
      min-height:100vh; display:flex; flex-direction:column; align-items:center; gap:.75rem; padding:1rem;
    }
    h1{margin:.25rem 0; color:var(--accent); font-weight:700; letter-spacing:.5px}
    .row{display:flex; gap:.75rem; flex-wrap:wrap; align-items:center; justify-content:center}
    .card{
      background:var(--card); border:1px solid var(--muted); border-radius:12px;
      padding:.75rem 1rem;
    }
    select, .btn{
      appearance:none; background:var(--card); color:var(--ink);
      border:1px solid var(--muted); border-radius:10px; padding:.6rem .9rem;
      font-weight:600; cursor:pointer; transition:background .2s,color .2s,transform .04s ease-in-out;
    }
    .btn:hover, select:hover{background:#17202a}
    .btn:active{transform:translateY(1px)}
    .btn.primary{border-color:var(--accent-2)}
    .btn.primary:hover{background:var(--accent-2); color:#fff}
    .btn.accent{border-color:var(--accent)}
    .btn.accent:hover{background:var(--accent); color:#001013}
    .hud{
      display:flex; align-items:center; justify-content:center; gap:2rem; font-size:1.1rem;
      padding:.4rem .9rem; border-radius:10px; border:1px solid var(--muted); background:var(--card)
    }
    .score{font-size:1.35rem; font-weight:800; color:var(--accent)}
    .hi{opacity:.9}
    .canvas-wrap{
      width:min(960px,100%); /* responsive width */
    }
    canvas{
      width:100%; height:auto; /* CSS-scaled; internal resolution stays fixed */
      background:var(--card); border:2px solid var(--accent); border-radius:12px; display:block; margin:.5rem 0 0;
      touch-action:none;
    }
    /* Overlay */
    .overlay{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.55); backdrop-filter:blur(2px); z-index:10;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(520px,92%); background:var(--card); border:1px solid var(--muted); border-radius:14px; padding:1.2rem;
      text-align:center; box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .modal h2{margin:.25rem 0 .5rem; color:var(--accent)}
    .modal p{margin:.25rem 0 .9rem; opacity:.9}
    .modal .row{margin-top:.5rem}
    /* Mobile on-screen controls */
    .touch-controls{
      display:none; gap:.5rem; margin-top:.5rem; flex-wrap:wrap; justify-content:center;
    }
    .pad{
      min-width:86px; padding:.7rem 1rem; text-align:center; user-select:none;
    }
    @media (max-width: 768px){
      .touch-controls{display:flex}
    }
    /* Accessibility outlines */
    :focus-visible{outline:2px solid var(--accent); outline-offset:2px}
  </style>
</head>
<body>
  <h1>üèì Pong</h1>

  <div class="row">
    <label class="card" for="mode">Mode:
      <select id="mode" aria-label="Game mode">
        <option value="2p">2 Player</option>
        <option value="bot-easy">Bot (Easy)</option>
        <option value="bot-medium">Bot (Medium)</option>
        <option value="bot-hard">Bot (Hard)</option>
      </select>
    </label>

    <div class="hud">
      <span>Score <span class="score" id="lScore">0</span> : <span class="score" id="rScore">0</span></span>
      <span class="hi">High&nbsp;Score: <strong id="hiScore">0</strong></span>
    </div>

    <div class="row">
      <button class="btn primary" id="restartBtn" aria-label="Restart game">üîÅ Restart</button>
      <button class="btn accent" id="pauseBtn" aria-label="Pause or resume">‚è∏Ô∏è Pause</button>
      <button class="btn" id="backBtn" aria-label="Back">‚¨Ö Back</button>
    </div>
  </div>

  <div class="canvas-wrap">
    <canvas id="pong" width="800" height="500" aria-label="Pong game area"></canvas>
  </div>

  <!-- Mobile on-screen controls -->
  <div class="touch-controls" aria-hidden="false">
    <button class="btn pad" id="lUp">‚¨Ü Left</button>
    <button class="btn pad" id="lDown">‚¨á Left</button>
    <button class="btn pad" id="rUp">‚¨Ü Right</button>
    <button class="btn pad" id="rDown">‚¨á Right</button>
  </div>

  <!-- Overlay for Game Over / Paused -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="ovTitle">
    <div class="modal">
      <h2 id="ovTitle">Game Over</h2>
      <p id="ovText">Left wins 10 ‚Äì 8</p>
      <div class="row">
        <button class="btn primary" id="ovRestart">üîÅ Restart</button>
        <button class="btn" id="ovBack">‚¨Ö Back</button>
      </div>
    </div>
  </div>

  <p class="card" style="max-width:960px">
    <strong>Controls:</strong> Player&nbsp;1 ‚Äî W/S ¬∑ Player&nbsp;2 ‚Äî ‚Üë/‚Üì ¬∑ <kbd>P</kbd> Pause/Resume ¬∑ <kbd>R</kbd> Restart
  </p>

  <script>
    // ---- Elements
    const canvas = document.getElementById('pong');
    const ctx = canvas.getContext('2d');
    const modeSel = document.getElementById('mode');
    const lScoreEl = document.getElementById('lScore');
    const rScoreEl = document.getElementById('rScore');
    const hiScoreEl = document.getElementById('hiScore');
    const restartBtn = document.getElementById('restartBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const backBtn = document.getElementById('backBtn');
    const overlay = document.getElementById('overlay');
    const ovTitle = document.getElementById('ovTitle');
    const ovText = document.getElementById('ovText');
    const ovRestart = document.getElementById('ovRestart');
    const ovBack = document.getElementById('ovBack');

    // Mobile pads
    const lUp = document.getElementById('lUp');
    const lDown = document.getElementById('lDown');
    const rUp = document.getElementById('rUp');
    const rDown = document.getElementById('rDown');

    // ---- Game state
    const PADDLE_W = 12, PADDLE_H = 100;
    const WIN_TO = 10;

    let leftPaddle, rightPaddle, ball;
    let leftScore = 0, rightScore = 0;
    let frames = 0, botTargetY = canvas.height / 2;
    let running = false, paused = false;
    let animationId = null, lastTs = 0;

    // High score (single-player context: best left score)
    const HI_KEY = 'pongHighScore';
    hiScoreEl.textContent = localStorage.getItem(HI_KEY) ?? '0';

    function initState(){
      leftPaddle = {
        x: 10,
        y: canvas.height/2 - PADDLE_H/2,
        w: PADDLE_W, h: PADDLE_H, speed: 360, // px/s
        up:false, down:false
      };
      rightPaddle = {
        x: canvas.width - PADDLE_W - 10,
        y: canvas.height/2 - PADDLE_H/2,
        w: PADDLE_W, h: PADDLE_H, speed: 360,
        up:false, down:false
      };
      ball = {
        x: canvas.width/2, y: canvas.height/2,
        r: 8, speed: 420, // base speed px/s
        vx: 300 * (Math.random() < 0.5 ? -1 : 1),
        vy: 220 * (Math.random() < 0.5 ? -1 : 1)
      };
      leftScore = 0; rightScore = 0;
      frames = 0; botTargetY = canvas.height/2;
      updateScoreUI();
      hideOverlay();
    }

    function updateScoreUI(){
      lScoreEl.textContent = leftScore;
      rScoreEl.textContent = rightScore;
    }

    // ---- Drawing helpers
    function rect(x,y,w,h,color){ ctx.fillStyle=color; ctx.fillRect(x,y,w,h); }
    function circle(x,y,r,color){ ctx.fillStyle=color; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }
    function text(t,x,y,color,px=32){ ctx.fillStyle=color; ctx.font = `${px}px Arial`; ctx.fillText(t,x,y); }
    function drawNet(){
      for(let i=0;i<=canvas.height;i+=20){ rect(canvas.width/2 - 1, i, 2, 10, "#00ffff"); }
    }

    // ---- Game logic
    function resetBall(direction = (Math.random()<0.5?-1:1)){
      ball.x = canvas.width/2; ball.y = canvas.height/2;
      ball.speed = 420;
      ball.vx = 300 * direction;
      ball.vy = 220 * (Math.random() < 0.5 ? -1 : 1);
    }

    function botUpdate(dt) {
      // Bot tuning
      let botSpeed = 170;  // easy
      let reactionEvery = 10; // frames
      if (modeSel.value === 'bot-medium'){ botSpeed = 300; reactionEvery = 6; }
      if (modeSel.value === 'bot-hard'){ botSpeed = 360; reactionEvery = 3; }

      if (frames % reactionEvery === 0) botTargetY = ball.y;
      const center = rightPaddle.y + rightPaddle.h/2;
      const dead = 12;

      if (botTargetY < center - dead && rightPaddle.y > 0) {
        rightPaddle.y -= botSpeed * dt;
      } else if (botTargetY > center + dead && rightPaddle.y < canvas.height - rightPaddle.h) {
        rightPaddle.y += botSpeed * dt;
      }
    }

    function paddleMove(p, dt){
      if (p.up && p.y > 0) p.y -= p.speed * dt;
      if (p.down && p.y < canvas.height - p.h) p.y += p.speed * dt;
    }

    function collidePaddle(p){
      return (
        ball.x - ball.r < p.x + p.w &&
        ball.x + ball.r > p.x &&
        ball.y + ball.r > p.y &&
        ball.y - ball.r < p.y + p.h
      );
    }

    function reflectFromPaddle(p, isLeft){
      const collidePoint = ball.y - (p.y + p.h/2);
      const norm = collidePoint / (p.h/2); // -1..1
      const angle = (Math.PI/4) * norm;   // -45..45¬∞
      const speed = Math.hypot(ball.vx, ball.vy) + 10; // add a touch of speed
      const dir = isLeft ? 1 : -1;
      ball.vx = dir * speed * Math.cos(angle);
      ball.vy = speed * Math.sin(angle);
    }

    function update(dt){
      // Move ball
      ball.x += ball.vx * dt;
      ball.y += ball.vy * dt;

      // Walls
      if (ball.y + ball.r > canvas.height || ball.y - ball.r < 0){ ball.vy *= -1; }

      // Paddles
      if (collidePaddle(leftPaddle) && ball.vx < 0){ reflectFromPaddle(leftPaddle, true); }
      if (collidePaddle(rightPaddle) && ball.vx > 0){ reflectFromPaddle(rightPaddle, false); }

      // Score
      if (ball.x + ball.r < 0){
        rightScore++; updateScoreUI();
        if (rightScore >= WIN_TO) return gameOver('Right');
        resetBall(1);
      } else if (ball.x - ball.r > canvas.width){
        leftScore++; updateScoreUI();
        if (leftScore >= WIN_TO) return gameOver('Left');
        resetBall(-1);
      }

      // Paddles by input
      paddleMove(leftPaddle, dt);
      if (modeSel.value === '2p'){ paddleMove(rightPaddle, dt); }
      else { botUpdate(dt); }

      frames++;
    }

    function render(){
      rect(0,0,canvas.width,canvas.height,'#161b22');
      drawNet();
      text(leftScore, canvas.width/4, 50, '#00ffff');
      text(rightScore, (3*canvas.width)/4, 50, '#00ffff');
      rect(leftPaddle.x, leftPaddle.y, leftPaddle.w, leftPaddle.h, '#00ffff');
      rect(rightPaddle.x, rightPaddle.y, rightPaddle.w, rightPaddle.h, '#00ffff');
      circle(ball.x, ball.y, ball.r, '#00ffff');
    }

    // ---- Loop (requestAnimationFrame)
    function loop(ts){
      if (!running) return;
      if (paused){ animationId = requestAnimationFrame(loop); return; }
      const dt = Math.min(0.05, (ts - lastTs) / 1000) || (1/60); // seconds, clamp big gaps
      lastTs = ts;
      update(dt);
      render();
      animationId = requestAnimationFrame(loop);
    }

    function start(){
      if (running) return;
      running = true; paused = false; lastTs = performance.now();
      animationId = requestAnimationFrame(loop);
      pauseBtn.textContent = '‚è∏Ô∏è Pause';
    }
    function stop(){
      running = false;
      if (animationId){ cancelAnimationFrame(animationId); animationId = null; }
    }
    function togglePause(){
      if (!running) return;
      paused = !paused;
      pauseBtn.textContent = paused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
      if (!paused){ lastTs = performance.now(); }
      showOverlay(paused, 'Paused', 'Press Resume to continue');
    }

    // ---- Overlay
    function showOverlay(show, title='Game Over', text=''){
      overlay.classList.toggle('show', !!show);
      if (show){ ovTitle.textContent = title; ovText.textContent = text || ovText.textContent; }
    }
    function hideOverlay(){ overlay.classList.remove('show'); }

    function gameOver(winner){
      stop();
      // record simple high score (best left score)
      try {
        const oldHi = Number(localStorage.getItem(HI_KEY) || 0);
        if (leftScore > oldHi){ localStorage.setItem(HI_KEY, String(leftScore)); hiScoreEl.textContent = String(leftScore); }
      } catch {}
      showOverlay(true, 'Game Over', `${winner} wins ${leftScore} ‚Äì ${rightScore}`);
    }

    function restart(){
      stop();
      initState();
      start();
    }

    // ---- Controls (keyboard)
    document.addEventListener('keydown', e=>{
      const k = e.key;
      if (k === 'w' || k === 'W') leftPaddle.up = true;
      if (k === 's' || k === 'S') leftPaddle.down = true;
      if (modeSel.value === '2p'){
        if (k === 'ArrowUp') rightPaddle.up = true;
        if (k === 'ArrowDown') rightPaddle.down = true;
      }
      if (k === 'p' || k === 'P') togglePause();
      if (k === 'r' || k === 'R') restart();
    });
    document.addEventListener('keyup', e=>{
      const k = e.key;
      if (k === 'w' || k === 'W') leftPaddle.up = false;
      if (k === 's' || k === 'S') leftPaddle.down = false;
      if (modeSel.value === '2p'){
        if (k === 'ArrowUp') rightPaddle.up = false;
        if (k === 'ArrowDown') rightPaddle.down = false;
      }
    });

    // ---- On-screen (pointer) controls (work for mouse & touch)
    function bindPad(btn, prop, side){
      btn.addEventListener('pointerdown', e=>{ e.preventDefault(); (side==='L'?leftPaddle:rightPaddle)[prop] = true; btn.setAttribute('aria-pressed','true'); });
      const up = ()=>{ (side==='L'?leftPaddle:rightPaddle)[prop] = false; btn.setAttribute('aria-pressed','false'); };
      btn.addEventListener('pointerup', up);
      btn.addEventListener('pointercancel', up);
      btn.addEventListener('pointerleave', up);
    }
    bindPad(lUp,'up','L');   bindPad(lDown,'down','L');
    bindPad(rUp,'up','R');   bindPad(rDown,'down','R');

    // Hide right controls when playing bot
    function syncTouchControls(){
      const rightBtns = [rUp, rDown];
      const showRight = (modeSel.value === '2p');
      rightBtns.forEach(b => b.style.display = showRight ? '' : 'none');
    }
    modeSel.addEventListener('change', ()=>{ syncTouchControls(); restart(); });

    // ---- Buttons
    restartBtn.addEventListener('click', restart);
    pauseBtn.addEventListener('click', togglePause);
    backBtn.addEventListener('click', e=>{
      e.preventDefault();
      if (window.history.length > 1) window.history.back();
      else window.location.href = 'games.html';
    });
    ovRestart.addEventListener('click', restart);
    ovBack.addEventListener('click', ()=> backBtn.click());

    // Pause when tab hidden (nice touch)
    document.addEventListener('visibilitychange', ()=>{
      if (document.hidden && running && !paused){ togglePause(); }
    });

    // Boot
    initState();
    syncTouchControls();
    start();
  </script>
</body>
</html>
