<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Space Invaders â€” Samuel Barnhurst</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #0d1117;
      color: #e6edf3;
      text-align: center;
    }
    h1 { color: #00ffff; margin: 0.5em 0; }
    canvas {
      background: #161b22;
      border: 2px solid #00ffff;
      border-radius: 10px;
      display: block;
      margin: 0 auto;
    }
    .btn {
      display: inline-block;
      margin: 1em;
      padding: 0.6em 1.2em;
      border-radius: 8px;
      background: #161b22;
      border: 1px solid #30363d;
      text-decoration: none;
      color: #e6edf3;
      transition: background 0.2s;
    }
    .btn:hover { background: #00b3b3; color: #fff; }
  </style>
</head>
<body>
  <h1>ðŸ‘¾ Space Invaders</h1>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <a href="games.html" class="btn">â¬… Back to Game Hub</a>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Asset paths (must match exactly in GitHub repo)
    const ASSETS = {
      player: "assets/player.png",
      alien: "assets/alien.png",
      boss: "assets/boss.png",
      bullet: "assets/bullet.png",
      explosion: "assets/explosion.png"
    };

    const images = {};
    function loadImage(key, src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => { images[key] = img; resolve(); };
        img.onerror = () => reject(`Image failed: ${src}`);
        img.src = src;
      });
    }

    async function loadAll() {
      const keys = Object.keys(ASSETS);
      await Promise.all(keys.map(k => loadImage(k, ASSETS[k])));
    }

    // ---- Game State ----
    let score, lives, gameEnded, bossActive;
    let keys = {};
    let player, aliens, alienBullets, boss, playerBullets;
    let alienDir, alienSpeed;

    function initGame() {
      score = 0;
      lives = 3;
      gameEnded = false;
      bossActive = false;

      player = { x: canvas.width/2 - 25, y: canvas.height - 70, w: 50, h: 50, speed: 6, shootCooldown: 0 };
      aliens = [];
      const rows = 4, cols = 8, size = 40;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          aliens.push({ x: 80 + c*70, y: 60 + r*60, w: size, h: size, alive: true });
        }
      }
      alienDir = 1; alienSpeed = 0.6;
      playerBullets = []; alienBullets = [];
      boss = { x: canvas.width/2 - 80, y: 40, w: 160, h: 80, hp: 30, speed: 2, dir: 1, bullets: [] };
    }

    document.addEventListener("keydown", e => { keys[e.code] = true; });
    document.addEventListener("keyup", e => { keys[e.code] = false; });

    function aabb(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    function update() {
      if (gameEnded) return;

      if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
      if (keys["ArrowRight"] && player.x < canvas.width - player.w) player.x += player.speed;
      if (player.shootCooldown > 0) player.shootCooldown--;
      if (keys["Space"] && player.shootCooldown === 0) {
        playerBullets.push({ x: player.x+player.w/2-6, y: player.y, w: 12, h: 24, vy: -8 });
        player.shootCooldown = 10;
      }

      // Bullets
      for (let i = playerBullets.length-1; i>=0; i--) {
        const b = playerBullets[i]; b.y += b.vy;
        if (b.y < 0) { playerBullets.splice(i,1); continue; }
        for (const a of aliens) {
          if (a.alive && aabb(b, a)) { a.alive=false; score+=10; playerBullets.splice(i,1); break; }
        }
        if (bossActive && aabb(b, boss)) {
          boss.hp--; playerBullets.splice(i,1);
          if (boss.hp<=0) { bossActive=false; gameEnded=true; }
        }
      }

      // Aliens
      if (!bossActive) {
        let edge=false;
        for (const a of aliens) {
          if (!a.alive) continue;
          a.x += alienDir*alienSpeed;
          if (a.x < 10 || a.x+a.w > canvas.width-10) edge=true;
        }
        if (edge) { alienDir*=-1; for (const a of aliens){ if(a.alive) a.y+=18; } }
        if (Math.random()<0.02) {
          const shooters = aliens.filter(a=>a.alive);
          if (shooters.length) {
            const a=shooters[Math.floor(Math.random()*shooters.length)];
            alienBullets.push({ x:a.x+a.w/2-4, y:a.y+a.h, w:8, h:16, vy:4 });
          }
        }
        if (aliens.every(a=>!a.alive)) bossActive=true;
      }

      for (let i=alienBullets.length-1;i>=0;i--){
        const b=alienBullets[i]; b.y+=b.vy;
        if (b.y>canvas.height) { alienBullets.splice(i,1); continue; }
        if (aabb(b, player)) { alienBullets.splice(i,1); lives--; if(lives<=0) gameEnded=true; }
      }

      if (bossActive) {
        boss.x += boss.dir*boss.speed;
        if (boss.x<0||boss.x+boss.w>canvas.width) boss.dir*=-1;
        if (Math.random()<0.05) {
          boss.bullets.push({ x:boss.x+boss.w/2-6, y:boss.y+boss.h, w:12,h:24,vy:6 });
        }
        for (let i=boss.bullets.length-1;i>=0;i--){
          const b=boss.bullets[i]; b.y+=b.vy;
          if (b.y>canvas.height) { boss.bullets.splice(i,1); continue; }
          if (aabb(b,player)) { boss.bullets.splice(i,1); lives--; if(lives<=0) gameEnded=true; }
        }
      }
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#e6edf3"; ctx.font="18px sans-serif";
      ctx.fillText("Score: "+score,12,22); ctx.fillText("Lives: "+lives,canvas.width-90,22);

      ctx.drawImage(images.player,player.x,player.y,player.w,player.h);
      if(!bossActive){ for(const a of aliens){ if(a.alive) ctx.drawImage(images.alien,a.x,a.y,a.w,a.h); } }
      if(bossActive){ ctx.drawImage(images.boss,boss.x,boss.y,boss.w,boss.h); ctx.fillText("Boss HP: "+boss.hp,boss.x+20,boss.y-10); }

      for(const b of playerBullets){ ctx.drawImage(images.bullet,b.x,b.y,b.w,b.h); }
      for(const b of alienBullets){ ctx.drawImage(images.bullet,b.x,b.y,b.w,b.h); }
      if(bossActive){ for(const b of boss.bullets){ ctx.drawImage(images.bullet,b.x,b.y,b.w,b.h); } }

      if(gameEnded){
        ctx.fillStyle = (bossActive&&boss.hp<=0)?"#57e389":"#ff6b6b";
        ctx.font="48px sans-serif";
        const msg = (bossActive&&boss.hp<=0)?"YOU WIN!":"GAME OVER";
        ctx.fillText(msg, canvas.width/2-ctx.measureText(msg).width/2, canvas.height/2);
      }
    }

    function loop(){ update(); draw(); requestAnimationFrame(loop); }

    // Start game after assets load
    (async function start(){
      await loadAll();
      initGame();
      loop();
    })();
  </script>
</body>
</html>
